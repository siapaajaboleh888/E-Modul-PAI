<% const modules=dashboard.modules || []; %>
  <% const progress=dashboard.progress || []; %>
    <% const totalModules=modules.length; %>
      <% const finishedUnits=progress.filter(p=> (p.completion_percentage || 0) >= 100).length; %>
        <% const inProgressUnits=progress.filter(p=> (p.completion_percentage || 0) > 0 && (p.completion_percentage ||
          0) < 100).length; %>

            <!-- Header dengan Gradient -->
            <div class="mb-4">
              <h2 class="fw-bold mb-2"
                style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">
                üéì Dashboard Mahasiswa
              </h2>
              <p class="text-muted">Halo, <strong>
                  <%= currentUser ? currentUser.name : 'Mahasiswa' %>
                </strong>. Selamat belajar di E-Modul Interaktif PAI!</p>
            </div>

            <!-- Statistik Cards dengan Gradient -->
            <div class="row mb-4 g-3">
              <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100"
                  style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                  <div class="card-body text-white">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="text-white-50 mb-2">üìö Total Modul</h6>
                        <h2 class="fw-bold mb-0">
                          <%= totalModules %>
                        </h2>
                      </div>
                      <div class="fs-1 opacity-50">
                        <i class="bi bi-book-fill"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100"
                  style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                  <div class="card-body text-white">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="text-white-50 mb-2">‚úÖ Unit Selesai</h6>
                        <h2 class="fw-bold mb-0">
                          <%= finishedUnits %>
                        </h2>
                      </div>
                      <div class="fs-1 opacity-50">
                        <i class="bi bi-check-circle-fill"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100"
                  style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                  <div class="card-body text-white">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <h6 class="text-white-50 mb-2">‚è≥ Sedang Dikerjakan</h6>
                        <h2 class="fw-bold mb-0">
                          <%= inProgressUnits %>
                        </h2>
                      </div>
                      <div class="fs-1 opacity-50">
                        <i class="bi bi-hourglass-split"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Menu Utama Mahasiswa -->
            <h5 class="fw-bold mb-3 mt-4">üìã Menu Pembelajaran</h5>
            <div class="row mb-4 g-3">
              <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="bi bi-book text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Modul Pembelajaran</h5>
                    </div>
                    <p class="text-muted small">Akses materi, video, dan aktivitas per unit</p>
                    <a href="/student/modules" class="btn btn-sm btn-primary w-100">Buka Modul ‚Üí</a>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="bi bi-lightbulb text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Skenario PBL</h5>
                    </div>
                    <p class="text-muted small">Skenario masalah dan area refleksi</p>
                    <a href="/student/pbl" class="btn btn-sm btn-outline-danger w-100">Lihat PBL ‚Üí</a>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="bi bi-puzzle text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Aktivitas Interaktif</h5>
                    </div>
                    <p class="text-muted small">Kuis dan tugas untuk latihan</p>
                    <a href="/student/activities/overview" class="btn btn-sm btn-outline-info w-100">Lihat Aktivitas
                      ‚Üí</a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Progres & Penilaian -->
            <h5 class="fw-bold mb-3 mt-4">üìä Progres & Penilaian</h5>
            <div class="row mb-4 g-3">
              <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        <i class="bi bi-graph-up text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Progres Belajar</h5>
                    </div>
                    <p class="text-muted small">Lihat unit yang sudah selesai dan skor kuis</p>
                    <a href="/student/progress-report" class="btn btn-sm btn-success w-100">Lihat Laporan ‚Üí</a>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                        <i class="bi bi-clipboard-check text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Penilaian & Tugas</h5>
                    </div>
                    <p class="text-muted small">Lihat nilai dan feedback dari dosen</p>
                    <a href="/student/assessments" class="btn btn-sm btn-warning w-100">Lihat Penilaian ‚Üí</a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Referensi & Profil -->
            <h5 class="fw-bold mb-3 mt-4">üìñ Referensi & Profil</h5>
            <div class="row mb-4 g-3">
              <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                        <i class="bi bi-journal-text text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Glosarium</h5>
                    </div>
                    <p class="text-muted small">Daftar istilah kunci PAI dan penjelasannya</p>
                    <a href="/student/glossary" class="btn btn-sm btn-outline-dark w-100">Buka Glosarium ‚Üí</a>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card border-0 shadow-sm h-100 hover-lift">
                  <div class="card-body">
                    <div class="d-flex align-items-center mb-3">
                      <div class="p-2 rounded" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="bi bi-person-circle text-white fs-4"></i>
                      </div>
                      <h5 class="ms-3 mb-0 fw-bold">Profil Saya</h5>
                    </div>
                    <p class="text-muted small">Kelola informasi akun dan keamanan</p>
                    <a href="/student/profile" class="btn btn-sm btn-outline-primary w-100">Lihat Profil ‚Üí</a>
                  </div>
                </div>
              </div>
            </div>

            <!-- Modul Tersedia -->
            <h5 class="fw-bold mb-3 mt-5">üìö Modul Tersedia</h5>
            <div class="row">
              <div class="col-12">
                <div class="card border-0 shadow-sm">
                  <div class="card-body">
                    <% if (modules.length) { %>
                      <div class="row g-3">
                        <% modules.slice(0, 3).forEach(function(m) { %>
                          <div class="col-md-4">
                            <div class="card h-100 border hover-lift">
                              <div class="card-body">
                                <h6 class="fw-bold">
                                  <%= m.title %>
                                </h6>
                                <p class="text-muted small">
                                  <%= m.description || 'Tidak ada deskripsi' %>
                                </p>
                                <a href="/student/modules/<%= m.id %>" class="btn btn-sm btn-outline-primary w-100">Buka
                                  Modul ‚Üí</a>
                              </div>
                            </div>
                          </div>
                          <% }) %>
                      </div>
                      <% if (modules.length> 3) { %>
                        <div class="text-center mt-3">
                          <a href="/student/modules" class="btn btn-sm btn-primary">Lihat Semua Modul ‚Üí</a>
                        </div>
                        <% } %>
                          <% } else { %>
                            <div class="alert alert-info mb-0">
                              <i class="bi bi-info-circle"></i> Belum ada modul tersedia.
                            </div>
                            <% } %>
                  </div>
                </div>
              </div>
            </div>

            <style>
              .hover-lift {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
              }

              .hover-lift:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1) !important;
              }
            </style>